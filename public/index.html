<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>xicam assistente</title>
    <script src="https://unpkg.com/react/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script
      src="https://cdn.socket.io/4.7.2/socket.io.min.js"
      integrity="sha384-mZLF4UVrpi/QTWPA7BjNPEnkIfRFn4ZEO3Qt/HFklTJBj/gBOV8G3HcKn4NfQblz"
      crossorigin="anonymous"
    ></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
    />
    <style>
      body {
        font-family: "Open Sans", sans-serif;
      }
      .chat-box-expanded {
        height: 50vh;
        max-height: 80%;
      }
    </style>
  </head>
  <body
    class="bg-gray-900 text-white h-screen flex flex-col justify-center items-center"
  >
    <div id="app"></div>

    <script type="text/babel">
      function App() {
        const socket = io();
        const [currentInput, setCurrentInput] = React.useState("");
        const [messages, setMessages] = React.useState([]);

        React.useEffect(() => {
          // Función para manejar mensajes entrantes
          const handleIncomingMessage = (data) => {
            console.log("Mensaje recibido:", data);
            setMessages((prevMessages) => [...prevMessages, data]);
          };

          // Suscribirse al evento "message" cuando el componente se monta
          socket.on("message", handleIncomingMessage);

          // Limpiar suscripción cuando el componente se desmonta
          return () => {
            socket.off("message", handleIncomingMessage);
          };
        }, []);

        // Función para enviar un mensaje
        const sendMessage = () => {
          if (currentInput.trim() !== "") {
            socket.emit("message", { message: currentInput });
            setCurrentInput(""); // Limpiar el input después de enviar
          }
        };

        // Mantén un estado adicional para el input
        const handleInputChange = (e) => {
          setCurrentInput(e.target.value);
        };

        return (
          <div className="text-center p-6 w-full max-w-4xl">
            <h1 className="text-4xl font-semibold mb-10">
              ¿Cómo puedo ayudarte hoy?
            </h1>
            <div
              id="chat-section"
              className="bg-gray-800 p-4 rounded-xl shadow-xl w-full mb-4"
            >
              <div
                id="chat-box"
                className="border p-2 mb-2 overflow-y-scroll bg-gray-700 rounded chat-box-expanded"
              >
                {messages.map((message, index) => (
                  <div
                    key={index}
                    className={`flex ${
                      message.from === "user" ? "justify-end" : "justify-start"
                    }`}
                  >
                    <div
                      className={`p-2 rounded-lg ${
                        message.from === "user"
                          ? "bg-purple-600"
                          : "bg-gray-600"
                      }`}
                    >
                      <p className="text-sm">{message.message}</p>
                    </div>
                  </div>
                ))}
              </div>
              <div className="flex">
                <input
                  id="message-input"
                  type="text"
                  className="flex-grow p-2 border rounded-l focus:ring focus:ring-purple-200 focus:border-transparent bg-gray-700 text-white"
                  placeholder="Escribe un mensaje..."
                  value={currentInput}
                  onChange={handleInputChange}
                  onKeyPress={(e) => {
                    if (e.key === "Enter") {
                      sendMessage();
                    }
                  }}
                  autocomplete="off"
                />
                <button
                  id="send-button"
                  className="bg-purple-600 text-white p-2 rounded-r hover:bg-purple-700 focus:outline-none"
                  onClick={sendMessage}
                >
                  Enviar
                </button>
              </div>
            </div>
            <p className="text-gray-400 text-xs mt-10">
              Xicam AI puede cometer errores. Considera verificar la información
              importante.
            </p>
          </div>
        );
      }

      ReactDOM.render(<App />, document.getElementById("app"));
    </script>
    <script src="/socket.io/socket.io.js"></script>
  </body>
</html>
